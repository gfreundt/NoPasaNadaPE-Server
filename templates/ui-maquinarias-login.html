{% extends "ui-pagina-base-maquinarias.html" %}

{% block title %}
Bienvenido a No Pasa Nada PE
{% endblock %}

{% block content %}
<div class="d-flex flex-column align-items-center w-100 px-4 py-4"
     style="font-family: 'Inter', sans-serif; font-weight: 700; max-width: 520px; margin: auto;">

    <div class="d-flex justify-content-center pt-4 pb-4 align-items-center w-100">
        <img src="/static/images/logo-nopasanadape-transparente-negro.png"
             style="width: 60px; height: auto;" class="me-3">

        <div style="height: 45px; width: 1px; background-color: black;"></div>

        <img src="/static/images/maquinarias-icon.png"
             style="height: 60px; width: auto;" class="ms-3">
    </div>

    <div class="text-center mb-4 w-100">
        <h1 class="fw-bold mb-1" style="font-size: 2.3rem;">No Pasa Nada PE</h1>
        <h2 class="fs-5 fw-normal text-secondary mb-2">un servicio exclusivo para</h2>
        <img src="/static/images/maquinarias-logo.png" style="height: 30px;">
    </div>

    <div class="w-100" style="max-width: 500px; font-weight: 400;">

        <div class="d-flex align-items-center my-4">
            <div class="flex-grow-1 border-top opacity-50"></div>
            <div class="text-secondary small mx-3" style="font-size: 1rem;">Inicia sesión con</div>
            <div class="flex-grow-1 border-top opacity-50"></div>
        </div>

        <div class="d-flex flex-wrap justify-content-center gap-3">

            {% set providers = [
                ('google_login', 'google-icon.png', 'Google'),
                ('apple_login', 'apple-icon.png', 'Apple'),
                ('microsoft_login', 'microsoft-icon.png', 'Microsoft'),
                ('facebook_login', 'facebook-icon.png', 'Facebook'),
                ('instagram_login', 'instagram-icon.png', 'Instagram')
            ] %}

            {% for route, icon, label in providers %}
            <a href="{{ url_for(route) }}"
               class="btn btn-light d-flex flex-column align-items-center justify-content-center py-3"
               style="
                    flex: 1 1 130px; 
                    height: 90px; 
                    border: 1px solid #D0D0D0;
                    border-radius: 12px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.12);
                    font-size: 1.05rem;
                    font-weight: 600;
                ">
                <img src="/static/images/{{ icon }}" style="width: 28px; margin-bottom: 8px;">
                <span>{{ label }}</span>
            </a>
            {% endfor %}
        </div>

        <div class="d-flex align-items-center my-4">
            <div class="flex-grow-1 border-top opacity-50"></div>
            <div class="text-secondary small mx-3" style="font-size: 1rem;">o continúa con</div>
            <div class="flex-grow-1 border-top opacity-50"></div>
        </div>

        <form method="POST" class="w-100">

            <input type="hidden" name="show_password_field"
                   value="{{ 'true' if show_password_field else 'false' }}">

            <label class="form-label text-secondary d-flex justify-content-center mb-1" style="font-size: 1rem;">
                <img src="/static/images/email-icon.png" style="height: 26px; margin-right: 8px;">
                Correo electrónico
            </label>

            <input id="email-input" name="correo_ingresado"
                   class="form-control mt-2 p-3"
                   style="height: 56px; font-size: 1.1rem; border-radius: 10px;"
                   placeholder="Ingresa tu correo..."
                   autocomplete="email"
                   value="{{ user_data.correo_ingresado if user_data.correo_ingresado }}"
                   required
                   {% if show_password_field %}readonly style="background:#f0f0f0;"{% endif %}>

            {% if errors.correo %}
            <div class="invalid-feedback text-center mb-2 d-block">{{ errors.correo }}</div>
            {% endif %}

            {% if show_password_field %}
                <label class="form-label text-secondary d-flex justify-content-center mt-4 mb-1" style="font-size: 1rem;">
                    <img src="/static/images/password-icon.png" style="height: 26px; margin-right: 8px;">
                    Contraseña
                </label>

                <input id="password-input" name="password_ingresado"
                    type="password" autocomplete="current-password"
                    class="form-control mt-2 p-3"
                    style="height: 56px; font-size: 1.1rem; border-radius: 10px;"
                    placeholder="Ingresa tu contraseña"
                    required>

                {% if errors.password %}
                    <div class="invalid-feedback text-center mb-2 d-block">{{ errors.password }}</div>
                {% endif %}
                
                <p class="text-center mt-2 mb-0">
                    <a href="#" class="small fw-medium" 
                       data-bs-toggle="modal" 
                       data-bs-target="#forgotPasswordModal"
                       style="color: rgb(35, 131, 226); text-decoration: underline; cursor: pointer;">
                        ¿Olvidaste tu contraseña?
                    </a>
                </p>
            {% endif %}

            <button type="submit"
                class="btn btn-primary w-100 fw-bold mt-4"
                style="
                    height: 52px;
                    font-size: 1.2rem;
                    border-radius: 10px;
                    background: rgb(35, 131, 226);
                    border-color: rgb(35, 131, 226);
                    box-shadow: 0 2px 4px rgba(0,0,0,0.18);
                ">
                Continuar
            </button>
        </form>
    </div>

    <p class="text-center small mt-4" style="font-size: 0.95rem; color:#555;">
    Si necesitas ayuda, escríbenos a 
    <a href="mailto:info@nopasanadape.com" style="color: #555; text-decoration: none;">
        info@nopasanadape.com.
    </a>
</p>

</div>

{# --- MODAL FOR PASSWORD RECOVERY --- #}
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="forgotPasswordModalLabel">Recuperar Contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p>Enviaremos una contraseña temporal a su dirección de correo ({{ user_data.correo_ingresado if user_data.correo_ingresado else 'ingresado' }}).</p>
                <p>Use esa nueva contraseña para ingresar.</p>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-secondary fw-bold" data-bs-dismiss="modal">Cancelar</button>
                {# The button links to the password reset route #}
                <a href="{{ url_for('nuevo_password') }}" class="btn btn-primary fw-bold">Enviar Correo</a>
            </div>
        </div>
    </div>
</div>

{% endblock %}